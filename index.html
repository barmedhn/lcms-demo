<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BARMED¬Æ ‚Äî Legal Case Management (Demo)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    #errbar{display:none}
  </style>
</head>
<body class="bg-gray-50">
  <div id="errbar" class="fixed top-0 left-0 right-0 z-[9999] bg-red-600 text-white px-4 py-2 text-sm"></div>

  <div class="min-h-full">
    <header class="sticky top-0 z-20 border-b border-gray-200 bg-white/80 backdrop-blur">
      <div class="mx-auto max-w-7xl px-4 py-3 sm:px-6 lg:px-8 flex items-center gap-4">
        <div class="flex items-center gap-3">
          <div class="h-10 w-10 rounded-xl bg-sky-600 text-white grid place-items-center font-extrabold">B</div>
          <div>
            <h1 class="text-lg font-bold leading-tight">BARMED¬Æ ‚Äî Legal Case Management (Demo)</h1>
            <p class="text-xs text-gray-500">Client-side only ‚Ä¢ Almacena datos en su navegador (localStorage)</p>
          </div>
        </div>
        <div class="ml-auto flex items-center gap-2">
          <button id="runTestsBtn" class="rounded-xl px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-black/5">Run Tests</button>
          <button id="exportBtn" class="rounded-xl px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-black/5">Export JSON</button>
          <label class="rounded-xl px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-black/5 cursor-pointer">Import JSON<input id="importInput" type="file" accept="application/json" class="sr-only"/></label>
          <button id="resetBtn" class="rounded-xl px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-red-200 text-red-600">Reset Data</button>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-7xl p-4 sm:p-6 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-6">
      <aside class="lg:col-span-3 xl:col-span-2">
        <nav class="rounded-2xl bg-white shadow-lg ring-1 ring-black/5 p-3">
          <div class="text-xs mb-2 text-gray-500 px-2">Modules</div>
          <ul id="nav" class="space-y-1">
            <li><button data-view="dashboard" class="w-full text-left px-3 py-2 rounded-lg hover:bg-sky-50">üè† Dashboard</button></li>
            <li><button data-view="cases" class="w-full text-left px-3 py-2 rounded-lg hover:bg-sky-50">üìÅ Cases</button></li>
            <li><button data-view="documents" class="w-full text-left px-3 py-2 rounded-lg hover:bg-sky-50">üìé Documents</button></li>
            <li><button data-view="time" class="w-full text-left px-3 py-2 rounded-lg hover:bg-sky-50">‚è±Ô∏è Time & Billing</button></li>
            <li><button data-view="clients" class="w-full text-left px-3 py-2 rounded-lg hover:bg-sky-50">üë• Clients / Portal</button></li>
            <li><button data-view="workflows" class="w-full text-left px-3 py-2 rounded-lg hover:bg-sky-50">üß© Workflows</button></li>
            <li><button data-view="reports" class="w-full text-left px-3 py-2 rounded-lg hover:bg-sky-50">üìä Reports</button></li>
            <li><button data-view="proposals" class="w-full text-left px-3 py-2 rounded-lg hover:bg-sky-50">üìÑ Proposals</button></li>
            <li><button data-view="settings" class="w-full text-left px-3 py-2 rounded-lg hover:bg-sky-50">‚öôÔ∏è Settings</button></li>
          </ul>
        </nav>
        <div class="rounded-2xl bg-white shadow-lg ring-1 ring-black/5 p-4 mt-4">
          <div class="text-sm font-semibold">Quick Add</div>
          <div class="mt-3 flex flex-col gap-2">
            <button id="quickNewCase" class="rounded-xl px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-black/5 bg-sky-600 text-white">New Case</button>
            <button id="quickNewClient" class="rounded-xl px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-black/5">New Client</button>
          </div>
        </div>
      </aside>

      <section id="content" class="lg:col-span-9 xl:col-span-10 space-y-6"></section>
    </main>
  </div>

  <script>
  window.addEventListener('error', function (e) {
    var bar = document.getElementById('errbar');
    bar.textContent = 'JS error: ' + (e && e.message ? e.message : 'unknown');
    bar.style.display = 'block';
  });

  window.addEventListener('DOMContentLoaded', function () {
    try {
      const LS_KEY='barmed_lcms_v1'; const nowISO=()=>new Date().toISOString(); const uid=(p='id')=>p+'_'+Math.random().toString(36).slice(2,9);
      const defaultData=()=>({settings:{hourlyRate:100,currency:'USD',firmName:'BARMED¬Æ',taxPercent:0,locale:'es-HN'},clients:[],cases:[],documents:[],portalMessages:[]});
      let DB=load();
      function load(){ try{ const raw=localStorage.getItem(LS_KEY); return raw?JSON.parse(raw):defaultData(); }catch(e){ return defaultData(); } }
      function save(){ localStorage.setItem(LS_KEY, JSON.stringify(DB)); }

      function el(h){ const t=document.createElement('template'); t.innerHTML=h.trim(); return t.content.firstElementChild; }
      function renderReportMini(){ const content=document.getElementById('content'); const container=el(`<div class="rounded-2xl bg-white shadow-lg ring-1 ring-black/5 p-4 mt-4"><canvas id="mini"></canvas></div>`); content.appendChild(container); try{ if(window.Chart){ const ctx=document.getElementById('mini'); new Chart(ctx,{type:'bar',data:{labels:['A','B'],datasets:[{label:'Demo',data:[1,2]}]},options:{plugins:{legend:{display:false}}}});} }catch(err){ /* ignore */ } }

      const routes={
        dashboard(){ const content=document.getElementById('content'); content.innerHTML=`<div class="rounded-2xl bg-white shadow-lg ring-1 ring-black/5 p-5">Dashboard ready</div>`; renderReportMini(); },
        cases(){ document.getElementById('content').innerHTML=`<div class="rounded-2xl bg-white shadow-lg ring-1 ring-black/5 p-4">Cases here</div>`; },
        documents(){ document.getElementById('content').innerHTML=`<div class="rounded-2xl bg-white shadow-lg ring-1 ring-black/5 p-4">Docs here</div>`; },
        time(){ document.getElementById('content').innerHTML=`<div class="rounded-2xl bg-white shadow-lg ring-1 ring-black/5 p-4">Time here</div>`; },
        clients(){ document.getElementById('content').innerHTML=`<div class="rounded-2xl bg-white shadow-lg ring-1 ring-black/5 p-4">Clients here</div>`; },
        workflows(){ document.getElementById('content').innerHTML=`<div class="rounded-2xl bg-white shadow-lg ring-1 ring-black/5 p-4">Workflows here</div>`; },
        reports(){ document.getElementById('content').innerHTML=`<div class="rounded-2xl bg-white shadow-lg ring-1 ring-black/5 p-4">Reports here</div>`; },
        proposals(){ document.getElementById('content').innerHTML=`<div class="rounded-2xl bg-white shadow-lg ring-1 ring-black/5 p-4">Proposals here</div>`; },
        settings(){ const c=document.getElementById('content'); c.innerHTML=`<div class="rounded-2xl bg-white shadow-lg ring-1 ring-black/5 p-4"><div class="text-sm">Settings</div><input id="sFirm" class="rounded-xl border px-3 py-2 mt-2" value="${DB.settings.firmName}"><button id="btnSaveSettings" class="rounded-xl px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-black/5 mt-3">Save</button></div>`; document.getElementById('btnSaveSettings').onclick=function(){ DB.settings.firmName=document.getElementById('sFirm').value||'BARMED¬Æ'; save(); alert('Saved'); }; }
      };

      const nav=document.getElementById('nav');
      nav.addEventListener('click', (e)=>{ if(e.target.matches('button[data-view]')){ const v=e.target.getAttribute('data-view'); renderView(v); [...nav.querySelectorAll('button')].forEach(b=>b.classList.remove('bg-sky-100')); e.target.classList.add('bg-sky-100'); }});
      function renderView(v){ window.location.hash=v; (routes[v]||routes.dashboard)(); }
      window.addEventListener('hashchange', ()=>{ const v=location.hash.replace('#','')||'dashboard'; renderView(v); });

      document.getElementById('runTestsBtn').onclick=function(){ alert('Events wired. If you see this, buttons work.'); };
      document.getElementById('exportBtn').onclick=function(){ alert('Export clicked'); };
      document.getElementById('importInput').addEventListener('change', function(){ alert('Import selected'); });
      document.getElementById('resetBtn').onclick=function(){ if(confirm('Reset demo data?')){ DB=defaultData(); save(); renderView('dashboard'); } };

      document.getElementById('quickNewCase').onclick=function(){ renderView('cases'); };
      document.getElementById('quickNewClient').onclick=function(){ renderView('clients'); };

      if(!localStorage.getItem(LS_KEY)){ DB=defaultData(); save(); }

      const initial=(location.hash||'#dashboard').replace('#',''); renderView(initial); const btn=nav.querySelector(`button[data-view="${initial||'dashboard'}"]`); if(btn) btn.classList.add('bg-sky-100');
    } catch (e) {
      var bar = document.getElementById('errbar');
      bar.textContent = 'Init error: ' + e.message;
      bar.style.display = 'block';
    }
  });
  </script>
</body>
</html>
